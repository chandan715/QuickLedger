<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - QuickLedger</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            border-bottom: 1px solid #444;
        }

        .navbar-brand {
            font-weight: 600;
            font-size: 1.2rem;
        }

        h5, h4 {
            font-weight: 600;
        }

        .card {
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .card-header {
            font-weight: 500;
            background-color: #f1f3f5;
            border-bottom: 1px solid #ddd;
        }

        .table th, .table td {
            vertical-align: middle;
        }

        .table-hover tbody tr:hover {
            background-color: #f9fafb;
        }

        .btn {
            border-radius: 6px;
            font-weight: 500;
        }

        .btn-sm {
            padding: 5px 12px;
        }

        .form-control, select {
            border-radius: 8px;
        }

        .filter-btns a {
            margin-right: 5px;
        }

        .filter-btns .active {
            box-shadow: 0 0 6px rgba(0,0,0,0.2) inset;
        }

        .section-title {
            margin: 25px 0 15px;
            font-weight: 600;
            color: #333;
            text-align: center;
        }

        /* Expanded filter card */
        .filter-card {
            max-width: 1000px;
            margin: 0 auto 25px auto;
        }

        /* Note input styling */
        .input-group-text {
            font-weight: 500;
            color: #555;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-dark px-3">
        <a class="navbar-brand" href="#">QuickLedger</a>
        <div>
            <span class="text-white me-3">Welcome, {{ email }}</span>
            <a href="/logout" class="btn btn-outline-light btn-sm">Logout</a>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Summary Cards -->
        <div class="row mb-4 text-center">
            <h5 class="mb-3">Overall Summary</h5>
            <div class="col-md-4">
                <div class="card border-success">
                    <div class="card-body">
                        <h6 class="text-success">Total Income</h6>
                        <h4>‚Çπ {{ income }}</h4>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-danger">
                    <div class="card-body">
                        <h6 class="text-danger">Total Expense</h6>
                        <h4>‚Çπ {{ expense }}</h4>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card border-primary">
                    <div class="card-body">
                        <h6 class="text-primary">Balance</h6>
                        <h4>‚Çπ {{ balance }}</h4>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Transaction -->
        <div class="card shadow-sm mb-4">
            <div class="card-header">Add Transaction</div>
            <div class="card-body">
                <form method="POST">
                    <div class="row g-3">
                        <div class="col-md-3">
                            <input type="number" step="0.01" name="amount" class="form-control" placeholder="Amount" required>
                        </div>
                        <div class="col-md-3">
                            <select name="category" class="form-control" required>
                                <option value="">-- Select --</option>
                                <option value="Income">Income</option>
                                <option value="Expense">Expense</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <div class="input-group">
                                <span class="input-group-text bg-light">Note</span>
                                <input type="text" name="note" class="form-control"
                                    placeholder="e.g. groceries, salary, shopping, bill, etc...">
                            </div>
                            <small class="form-text text-muted">
                                Add a short description ‚Äî helps you remember the purpose of each transaction.
                            </small>
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100">Add</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <!-- Filter Transactions -->
        <div class="card shadow-sm mb-4">
            <div class="card-header">Filter Transactions</div>
            <div class="card-body">
                <form method="GET" action="/dashboard" class="row g-3">
                    <div class="col-md-3">
                        <input type="date" name="start_date" value="{{ start_date or '' }}" class="form-control">
                    </div>
                    <div class="col-md-3">
                        <input type="date" name="end_date" value="{{ end_date or '' }}" class="form-control">
                    </div>
                    <div class="col-md-4">
                        <input type="text" name="note" value="{{ search_note or '' }}" class="form-control" 
                            placeholder="Search by note (e.g. groceries, salary)">
                    </div>
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-dark w-100">Apply</button>
                    </div>
                </form>
            </div>
        </div>


        <!-- Top 5 Expenses -->
        <h5 class="section-title">Top 5 Expenses</h5>
        <div class="card shadow-sm mb-4">
            <div class="card-body p-0">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>Rank</th>
                            <th>Category</th>
                            <th>Total Spent (‚Çπ)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for i in range(categories|length) %}
                        <tr>
                            <td>{{ i+1 }}</td>
                            <td>{{ categories[i] }}</td>
                            <td>‚Çπ {{ amounts[i] }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="3" class="text-center text-muted">No expense data available</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Monthly Summary -->
        <h5 class="section-title">Monthly Summary</h5>
        <div class="card shadow-sm mb-4">
            <div class="card-body p-0">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>Month</th>
                            <th>Income (‚Çπ)</th>
                            <th>Expense (‚Çπ)</th>
                            <th>Balance (‚Çπ)</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in monthly_data %}
                        <tr>
                            <td>{{ row.year }}-{{ "%02d"|format(row.month) }}</td>
                            <td class="text-success">‚Çπ {{ row.income }}</td>
                            <td class="text-danger">‚Çπ {{ row.expense }}</td>
                            <td class="text-primary">‚Çπ {{ row.balance }}</td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="4" class="text-center text-muted">No monthly data available</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- All Transactions -->
        <h5 class="section-title">All Transactions</h5>
        <div class="card shadow-sm mb-4">
            <div class="card-body p-0">
                <table class="table table-striped table-hover mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th>Amount</th>
                            <th>Category</th>
                            <th>Note</th>
                            <th>Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for txn in transactions %}
                        <tr>
                            <td>‚Çπ {{ txn.amount }}</td>
                            <td>{{ txn.category }}</td>
                            <td>{{ txn.note }}</td>
                            <td>{{ txn.timestamp.strftime("%Y-%m-%d %H:%M") }}</td>
                            <td>
                                <form method="POST" action="/delete/{{ txn.id }}" style="display:inline;">
                                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                </form>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="text-center text-muted">No transactions yet</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Export Buttons -->
        <div class="d-flex justify-content-end mb-4">
            <a href="/export/csv" class="btn btn-outline-success btn-sm me-2">‚¨áÔ∏è Export CSV</a>
            <a href="/export/pdf" class="btn btn-outline-primary btn-sm">üìÑ Export PDF</a>
        </div>
    </div>
</body>
</html>
